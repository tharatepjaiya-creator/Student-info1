<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rename Department</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Wave Background -->
    <div class="wave-container">
        <svg class="wave-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" preserveAspectRatio="none">
            <path fill="#ffffff" d="M0,160 C360,260 720,60 1080,160 C1260,210 1350,180 1440,160 L1440,320 L0,320 Z"></path>
        </svg>
    </div>

    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-warning">
                <h3>✏️ Rename Department (Admin Only)</h3>
            </div>
            <div class="card-body">
                <p class="text-muted">This page will rename the department from:</p>
                <p class="fw-bold">"ช่างเครื่องกลโรงงาน" → "ช่างกลโรงงาน"</p>

                <button id="renameBtn" class="btn btn-primary btn-lg">
                    Rename Department
                </button>

                <div id="result" class="mt-3"></div>

                <hr>
                <a href="admin_dashboard.html" class="btn btn-secondary">← Back to Dashboard</a>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('renameBtn').addEventListener('click', async () => {
            if (!confirm('Are you sure you want to rename "ช่างเครื่องกลโรงงาน" to "ช่างกลโรงงาน"?')) {
                return;
            }

            const btn = document.getElementById('renameBtn');
            const result = document.getElementById('result');

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Processing...';
            result.innerHTML = '';

            try {
                const response = await fetch('/api/admin/rename-department', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.success) {
                    result.innerHTML = `
                        <div class="alert alert-success">
                            <strong>✅ Success!</strong><br>
                            ${data.message}
                        </div>
                    `;
                    setTimeout(() => {
                        window.location.href = 'admin_dashboard.html';
                    }, 2000);
                } else {
                    result.innerHTML = `
                        <div class="alert alert-danger">
                            <strong>❌ Error:</strong> ${data.error || 'Unknown error'}
                        </div>
                    `;
                }
            } catch (err) {
                result.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>❌ Network Error:</strong> ${err.message}
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Rename Department';
            }
        });
    </script>
</body>
</html>
